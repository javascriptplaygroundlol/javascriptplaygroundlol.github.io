<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>JavaScript Playground</title>
<link href="https://fonts.googleapis.com/css2?family=Victor+Mono&display=swap" rel="stylesheet">
<link rel="icon" type="image/x-icon" href="./js.jpg">
<style>
body {
  margin: 0;
  font-family: 'Victor Mono', monospace;
  display: flex;
  height: 100vh;
  overflow: hidden;
}
#sidebar {
  width: 250px;
  background:#1e1e1e;
  color:#d4d4d4;
  display:flex;
  flex-direction:column;
}
#explorerRoot { flex-grow:1; overflow:auto; padding:5px; }
.toolbar { display:flex; gap:5px; padding:5px; background:#2d2d2d; }
.toolbar button { flex:1; padding:5px; color:#fff; background:#3c3c3c; border:none; border-radius:3px; cursor:pointer; }
.toolbar button:hover { background:#505050; }

#editorContainer { flex-grow:1; display:flex; flex-direction:column; }
#tabs { height:30px; display:flex; background:#2d2d2d; overflow-x:auto; }
.tab { padding:5px 10px; cursor:pointer; color:#d4d4d4; display:flex; align-items:center; gap:4px; border-right:1px solid #555; }
.tab.active { background:#094771; color:#fff; }
#editor { flex-grow:1; }

.tree { list-style:none; margin:0; padding-left:10px; font-size:13px; }
.tree li { display:flex; align-items:center; gap:4px; padding:2px 4px; border-radius:3px; white-space:nowrap; cursor:default; user-select:none; }
.tree li:hover { background:#2b2b2f; }
.tree li .icon { width:16px; height:16px; flex-shrink:0; display:flex; align-items:center; justify-content:center; }
.tree li.folder > .name { font-weight:600; color:#9cdcfe; }
.tree li.file > .name { color:#d4d4d4; }
.tree li .children { display:none; padding-left:16px; transition: max-height 0.2s ease; overflow:hidden; }
.tree li.expanded > .children { display:block; }
.tree li.active { background:#094771; color:#fff; }
.chevron { width:12px; height:12px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
.chevron svg { width:12px; height:12px; fill:#888; transition: transform 0.2s ease; }
.tree li.expanded > .chevron svg { transform: rotate(90deg); }

#settingsModal {
  position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  background:#1e1e1e; color:#fff; padding:20px; border-radius:8px; display:none; z-index:1000;
}
#settingsModal input { background:#2d2d2d; color:#fff; border:none; padding:5px; margin:5px 0; border-radius:3px; width:100%; }
#settingsModal button { margin-top:10px; padding:5px 10px; border:none; border-radius:3px; background:#094771; color:#fff; cursor:pointer; }
</style>
</head>
<body>
<div id="sidebar">
  <div class="toolbar">
    <button id="openFolderBtn">Open Folder</button>
    <button id="newFileBtn">New File</button>
    <button id="newFolderBtn">New Folder</button>
    <button id="settingsBtn">Settings</button>
  </div>
  <div id="explorerRoot"></div>
</div>

<div id="editorContainer">
  <div id="tabs"></div>
  <div id="editor"></div>
</div>

<div id="settingsModal">
  <h3>Settings</h3>
  <label>Remember last folder:
    <input type="checkbox" id="rememberFolder">
  </label>
  <button id="closeSettings">Close</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.min.js"></script>
<script>
require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' }});
let editor;
let rootDirHandle;
let openTabs = [];

require(['vs/editor/editor.main'], function () {
  editor = monaco.editor.create(document.getElementById('editor'), {
    value: `console.log("JavaScript Playground");`,
    language: 'javascript',
    theme: 'vs-dark',
    fontFamily: 'Victor Mono',
    fontSize: 14,
  });
});

// Utility: highlight active file
function highlightActiveFile(activeLi) {
  document.querySelectorAll('.tree li').forEach(li=>li.classList.remove('active'));
  if(activeLi) activeLi.classList.add('active');
}

// Open file in editor & tabs
async function openTabFromHandle(fileHandle) {
  const file = await fileHandle.getFile();
  const text = await file.text();
  const existing = openTabs.find(t=>t.handle===fileHandle);
  if(existing){ selectTab(existing.li); return; }

  // Create new tab
  const tab = document.createElement('div'); tab.className='tab';
  tab.textContent=fileHandle.name;
  tab.addEventListener('click', ()=>{ editor.setValue(text); selectTab(tab); });
  document.getElementById('tabs').appendChild(tab);
  openTabs.push({handle:fileHandle, li:tab});
  editor.setValue(text);
  selectTab(tab);
}

function selectTab(tab) {
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  tab.classList.add('active');
}

// VSCode-style Explorer
async function renderDirectoryVSCode(dirHandle, container, parentPath='') {
  container.innerHTML = '';
  const ul = document.createElement('ul'); ul.className='tree';
  for await (const entry of dirHandle.values()) {
    const li = document.createElement('li');
    li.entryHandle = entry;
    li.parentHandle = dirHandle;
    li.dataset.path = parentPath + '/' + entry.name;

    const chevron = document.createElement('span'); chevron.className='chevron';
    const icon = document.createElement('span'); icon.className='icon';
    const nameSpan = document.createElement('span'); nameSpan.className='name'; nameSpan.textContent = entry.name;

    if(entry.kind==='directory'){
      li.classList.add('folder');
      chevron.innerHTML=`<svg viewBox="0 0 16 16"><path d="M6 4l4 4-4 4z"/></svg>`;
      icon.innerHTML=`<svg viewBox="0 0 16 16"><path d="M1 3h6l2 2h6v9H1z"/></svg>`;
      li.appendChild(chevron); li.appendChild(icon); li.appendChild(nameSpan);
      const childrenContainer=document.createElement('div'); childrenContainer.className='children'; li.appendChild(childrenContainer);

      const expanded=JSON.parse(localStorage.getItem('jstudios.expandedFolders')||'{}');
      if(expanded[li.dataset.path]) li.classList.add('expanded');

      chevron.addEventListener('click', async e=>{ e.stopPropagation(); li.classList.toggle('expanded'); expanded[li.dataset.path]=li.classList.contains('expanded'); localStorage.setItem('jstudios.expandedFolders', JSON.stringify(expanded)); });
      li.addEventListener('dblclick', ()=>li.classList.toggle('expanded'));
      await renderDirectoryVSCode(entry, childrenContainer, li.dataset.path);
    } else {
      li.classList.add('file');
      icon.innerHTML=`<svg viewBox="0 0 16 16"><path d="M4 0h8l4 4v12H0V0z"/></svg>`;
      li.appendChild(chevron); li.appendChild(icon); li.appendChild(nameSpan);
      li.addEventListener('click', async ()=>{ await openTabFromHandle(entry); highlightActiveFile(li); });
    }

    ul.appendChild(li);
  }
  container.appendChild(ul);
}

async function openFolderVSCodeStyle(handle){
  rootDirHandle = handle;
  await renderDirectoryVSCode(rootDirHandle, document.getElementById('explorerRoot'));
}

// Toolbar buttons
document.getElementById('openFolderBtn').addEventListener('click', async ()=>{
  rootDirHandle = await window.showDirectoryPicker();
  await openFolderVSCodeStyle(rootDirHandle);
});

document.getElementById('newFileBtn').addEventListener('click', async ()=>{
  if(!rootDirHandle) return alert("Open a folder first!");
  const name = prompt("File name:"); if(!name) return;
  const fileHandle = await rootDirHandle.getFileHandle(name,{create:true});
  await openFolderVSCodeStyle(rootDirHandle);
});

document.getElementById('newFolderBtn').addEventListener('click', async ()=>{
  if(!rootDirHandle) return alert("Open a folder first!");
  const name = prompt("Folder name:"); if(!name) return;
  await rootDirHandle.getDirectoryHandle(name,{create:true});
  await openFolderVSCodeStyle(rootDirHandle);
});

// Settings modal
const settingsModal = document.getElementById('settingsModal');
document.getElementById('settingsBtn').addEventListener('click', ()=>{ settingsModal.style.display='block'; });
document.getElementById('closeSettings').addEventListener('click', ()=>{ settingsModal.style.display='none'; });
</script>
</body>
</html>
